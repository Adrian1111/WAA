<div ng-controller="reportCtrl">

    <div class="col-md-12" ng-show="visiblePlotw">
        <h2>Udział zgłoszeń w bazie</h2>
        <div class="prompt-statistics">
            <dl id="chart">
                <dt>Nowe</dt>
                <dd><span class="data-one" style="width:{{visiblePlot.newed/visiblePlot.sum*100}}%;">{{visiblePlot.newed/visiblePlot.sum*100|number:1}}%</span>
                </dd>

                <dt>Odrzucone</dt>
                <dd><span class="data-one" style="width:{{visiblePlot.canceled/visiblePlot.sum*100}}%;">{{visiblePlot.canceled/visiblePlot.sum*100|number:1}}%</span>
                </dd>
                <dt>Zaakceptowane</dt>
                <dd><span class="data-one" style="width:{{visiblePlot.accepted/visiblePlot.sum*100}}%;">{{visiblePlot.accepted/visiblePlot.sum*100|number:1}}%</span>
                </dd>
                <dt>Zakończone</dt>
                <dd><span class="data-one" style="width:{{visiblePlot.ended/visiblePlot.sum*100}}%;">{{visiblePlot.ended/visiblePlot.sum*100|number:1}}%</span>
                </dd>
            </dl>
        </div>
    </div>

    <div ng-show="selectedReport">
        <div>
            <h2 tabindex="0">Informacje szczegółowe</h2>

            <table class="table table-striped table-bordered">
                <tr>
                    <th>Nazwa Pola</th>
                    <th>Zawartość</th>
                </tr>
                <tr>
                    <td>Nazwa użytkownika</td>
                    <td>{{selectedReport.username}}</td>
                </tr>
                <tr>
                    <td>
                        Adres<br>
                        email {{item.email}}<br>
                        telefon {{item.phonenumber}}<br>
                    </td>
                    <td>{{selectedReport.street}}
                        {{selectedReport.streetnumber}} /
                        {{selectedReport.apartmentnumber}}
                        {{selectedReport.citycode}}
                        {{selectedReport.city}}<br>
                        {{selectedReport.email}}<br>
                        {{selectedReport.phonenumber}}
                    </td>
                </tr>
                <tr>Data dodania
                    <td></td>
                    <td>{{selectedReport.insertion_date| limitTo: 10}}</td>
                </tr>
                <tr>
                    <td>Priorytet</td>
                    <td><select ng-model="selectedReport.priority"
                                ng-options="priority.name as priority.name for priority in data.priority"
                                ng-click="updateReport(selectedReport);refreshPlot();" required>
                        <option value="">{{selectedReport.priority}}</option>
                    </select></td>
                </tr>
                <tr>
                    <td>Gdzie</td>
                    <td>{{selectedReport.place}}</td>
                </tr>
                <tr>
                    <td>Tytuł</td>
                    <td><input ng-model="selectedReport.title" ng-keyup="updateReport(selectedReport);refreshPlot();"
                               required/></td>
                </tr>
                <tr>
                    <td>Opis</td>
                    <td>{{selectedReport.description}}</td>
                </tr>
                <tr>
                    <td>Sugestie</td>
                    <td>{{selectedReport.sugestions}}</td>
                </tr>
                <tr>
                    <td>Zdjęcia</td>
                    <td>
                        <div>
                            <img id="obrazek" data-ng-src="{{'data:image/png;base64,'+selectedReport.photo}}"
                                 width="300" height="220" ng-click="zmniejszObraz()">
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Status</td><!--<td>{{selectedReport.status|statusName}}</td>-->
                    <td>
                        <!--<input ng-model="editedReport.status" required />-->
                        <select ng-model="selectedReport.status"
                                ng-options="status.value as status.name for status in data.status"
                                ng-click="updateReport(selectedReport);refreshPlot();" required>
                            <option value="">{{selectedReport.status|statusName}}</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>
                        <button ng-click="updateReport(selectedReport);refreshPlot(); reloadPage2();"
                                class="btn btn-xs btn-primary">Zapisz
                        </button>
                    </td>
                </tr>
            </table>

        </div>
    </div>
    <div id="status-submission-table" class="stick-left">
        <div>
            <th>Show submission with status:</th>
        </div>
        <div>
            <div style="padding: 5px;float:left;" ng-repeat="status in getCategories()"><input type="checkbox"
               ng-model="filter[status]" ng-init="filter[status]=true">
                {{status|statusName}}
            </div>
        </div>
    </div>

    <div class="col-md-12">
        <div class="panel panel-default fixed-width">
            <div class="panel-body">
                <table id="reportTable" class="table table-condensed transform-table" style="border-collapse:collapse;">
                    <thead>
                    <tr>
                        <th style="width:225px;"><a href="" ng-click="order('username')">Użytkownik</a>
                            <span class="sortorder" ng-show="predicate === 'username'" ng-class="{reverse:reverse}">
                     </span>
                        </th>
                        <th>
                            <a href="" ng-click="order('priority')">Priorytet</a>
                            <span class="sortorder" ng-show="predicate === 'priority'" ng-class="{reverse:reverse}">
                     </span></th>
                        <th><a href="" ng-click="order('title')">Tytuł</a>
                            <span class="sortorder" ng-show="predicate === 'title'" ng-class="{reverse:reverse}">
                     </span>
                        </th>
                        <th>
                            <a href="" ng-click="order('status')">Status</a>
                            <span class="sortorder" ng-show="predicate === 'status'" ng-class="{reverse:reverse}">
                        <th></th>

                    </tr>
                    </thead>
                    <tbody class="prompt-data-table-body" ng-repeat="item in filtered=(report | filter:filterByCategory) | orderBy:predicate:reverse| filter:categoryFilterFn"
                           ng-hide="item.id == editedReport.id">
                    <tr ng-keyup="$event.keyCode == 13 && onEnterPress(item)" ng-click="changeState(item)" alt="Expand new row with submission shortened details" tabindex="0">
                        <td>{{item.username}}</td>
                        <td>{{item.priority}}</td>
                        <td>{{item.title}}</td>
                        <td>{{item.status|statusName}}</td>
                        <td>
                            <button id="expand-row-button{{$index}}" class="btn btn-default btn-xs" ng-click="selectReport(item)" alt="Open submission extended details">
                                <span class="glyphicon glyphicon-eye-open"></span>
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="12" ng-class="{hiddenRow : hiddenRowState !== item} ">
                            <div class="hiddenContent" id="expand-row{{$index}}">
                                <table class="table hiddenTable">
                                    <thead>
                                    <tr>
                                        <td>Ulica</td>
                                        <td>numer domu/mieszkania</td>
                                        <td>Miasto</td>
                                        <td>Kod pocztowy</td>
                                        <td>email</td>
                                        <td>Telefon</td>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>{{item.street}}</td>
                                        <td>{{item.streetnumber}}/{{item.apartmentnumber}}</td>
                                        <td>{{item.city}}</td>
                                        <td>{{iem.citycode}}</td>
                                        <td>{{item.email}}</td>
                                        <td>{{item.phonenumber}}</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
